## 1. 实现的功能

- sys_get_time 和 sys_task_info

主要是要实现内存地址的转换，从内核地址空间转到用户地址空间

-  mmap 和 munmap 匿名映射
  
  mmap要判断是否和已有隐射有重叠
  
  munmap 要判断是否存在这个映射



## 2. 简答作业

### 2.1 请列举 SV39 页表页表项的组成，描述其中的标志位有何作用？

SV39 分页模式下的页表项，其中[53:10]  这 44 位是物理页号，最低的 8 位 [7:0] 则是标志位，它们的含义如下：

- 仅当 V(Valid) 位为 1 时，页表项才是合法的；

- R/W/X 分别控制索引到这个页表项的对应虚拟页面是否允许读/写/取指；

- U 控制索引到这个页表项的对应虚拟页面是否在 CPU 处于 U 特权级的情况下是否被允许访问；

- G 我们不理会；

- A(Accessed) 记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被访问过；

- D(Dirty) 则记录自从页表项上的这一位被清零之后，页表项的对应虚拟页表是否被修改过。

### 2.2 缺页

- 请问哪些异常可能是缺页导致的？
  
  1 Instruction access fault
  
  5 Load access fault
  
  7 store access fault
  
  12  Instruction page fault
  
  13  Load page fault 
- 发生缺页时，描述相关重要寄存器的值
  
  mtval：在发生缺页时，mtval 寄存器会被设置为导致缺页的原因，它包含了导致异常的指令或者**数据的虚拟地址**。
  
  mcause：该寄存器指示异常的原因。当发生缺页时，它会被设置为一个值，指示这是一个缺页异常。
  
  mepc：mepc 寄存器保存了导致异常的指令的地址。在缺页异常中，它保存的是发生异常的指令的地址。
- 这样做有哪些好处？ 可以保留更多内存，运行更多进程执行，减少IO,延迟页表操作直到真正需要访问页面，节省了资源和时间。
- 处理 10G 连续的内存页面，对应的 SV39 页表大致占用多少内存 (估算数量级即可)？
  
  10GB /每页4K  *  8 bytes = 20MB 的内存空间
- 将有效位设置为 0，同时保存页面的磁盘地址

### 2.3 双页表与单页表

- 在单页表情况下，如何更换页表？
  
  在进程切换时  修改satp 寄存器，只不过 用户线程 部分的线性空间映射到的内存地址不同，而内核线程部分映射到的物理内存不变

- 控制用户态无法访问内核页面，可以通过设置页表条目的权限位来实现。在单页表设计中，可以将内核页面对应的页表条目的权限设置为只允许内核态访问，而用户态访问则会引发异常，从而实现内核页面的保护。

- 单页表有何优势？ 在trap 发生的时候不需要切换页表，提高了trap性能

- 在双页表实现下，需要更换页表的时机通常是在   进程切换 和 发生系统调用 时。一个单页表操作系统，只需在进程切换时更换页表

## 3.荣誉准则

1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 **以下各位** 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：
   
   > 无

2. 此外，我也参考了 **以下资料** ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：
   
   > 《深入理解计算机系统》 第3版
   > 
   > [rCore-Tutorial-Book-v3 3.6.0-alpha.1 文档](https://rcore-os.cn/rCore-Tutorial-Book-v3/)
   > 
   > 导学视频
   > 
   > 《RISC-V 手册》

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。